<!DOCTYPE html>
<html lang="en">
<head>
    <!-- uses external CDN for prototyping and JavaScript can be placed in script files -->
    <meta charset="utf-8"/>
    <title>Prototype for edit and delete table</title>

    <link href="Lib/bootstrap/dist/css/bootstrap.css" rel="stylesheet"/>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">

    <!--suppress no favicon-->
    <link rel="shortcut icon" href="#">

    <style>
        /* Make first and last column only as wide as their header text */
        th:first-child, td:first-child,
        th:last-child, td:last-child {
            width: 1%;
            white-space: nowrap;
            text-align: center;
        }

        /* Center icons in those narrow cells */
        td a {
            display: inline-block;
            text-align: center;
        }
    </style>

</head>
<body>

<main>

    <div class="container">
        <h1 class="mb-3 fs-5 mt-5 text-center">People List</h1>

        <table class="table table-hover table-success align-middle table-bordered">
            <thead class="table-light">
            <tr>
                <th scope="col">Edit</th>
                <th scope="col">First Name</th>
                <th scope="col">Last Name</th>
                <th scope="col">Delete</th>
            </tr>
            </thead>
            <tbody>
            <tr>
                <td><a href="#" onclick="editPerson(this)" data-id="1" class="text-primary" aria-label="Edit John Doe"><i class="bi bi-pencil-square"></i></a></td>
                <td>John</td>
                <td>Doe</td>
                <td><a href="#" onclick="openDeleteModal(this); return false;" data-id="1" class="text-danger" aria-label="Delete John Doe"><i class="bi bi-trash"></i></a></td>
            </tr>
            <tr>
                <td><a href="#" onclick="editPerson(this)" data-id="2" class="text-primary" aria-label="Edit Jane Smith"><i class="bi bi-pencil-square"></i></a></td>
                <td>Jane</td>
                <td>Smith</td>
                <td><a href="#" onclick="openDeleteModal(this); return false;" data-id="2" class="text-danger" aria-label="Delete Jane Smith"><i class="bi bi-trash"></i></a></td>
            </tr>
            <tr>
                <td><a href="#" onclick="editPerson(this)" data-id="3" class="text-primary" aria-label="Edit Michael Johnson"><i class="bi bi-pencil-square"></i></a></td>
                <td>Michael</td>
                <td>Johnson</td>
                <td><a href="#" onclick="openDeleteModal(this); return false;" data-id="3" class="text-danger" aria-label="Delete Michael Johnson"><i class="bi bi-trash"></i></a></td>
            </tr>
            <tr>
                <td><a href="#" onclick="editPerson(this)" data-id="4" class="text-primary" aria-label="Edit Emily Brown"><i class="bi bi-pencil-square"></i></a></td>
                <td>Emily</td>
                <td>Brown</td>
                <td><a href="#" onclick="openDeleteModal(this); return false;" data-id="4" class="text-danger" aria-label="Delete Emily Brown"><i class="bi bi-trash"></i></a></td>
            </tr>
            <tr>
                <td><a href="#" onclick="editPerson(this)" data-id="5" class="text-primary" aria-label="Edit David Wilson"><i class="bi bi-pencil-square"></i></a></td>
                <td>David</td>
                <td>Wilson</td>
                <td><a href="#" onclick="openDeleteModal(this); return false;" data-id="5" class="text-danger" aria-label="Delete David Wilson"><i class="bi bi-trash"></i></a></td>
            </tr>
            </tbody>
        </table>
    </div>

</main>

<div id="modal-container"></div>


    <!-- Bootstrap Bundle with Popper -->
    <script src="Lib/bootstrap/dist/js/bootstrap.bundle.js"></script>
    <script>
        // Required: editPerson reads the id from an element attribute
        function editPerson(element) {
            const id = element.getAttribute('data-id');
            console.log(`Edit person with ID: ${id}`);
            alert(`Edit person with ID: ${id}`);
        }

        // Required: deletePerson reads the id from an element attribute
        function deletePerson(element) {
            const id = element.getAttribute('data-id');
            //alert(`Deleted person with ID: ${id}`);
            // remove the row from the UI after deletion
            const trigger = document.querySelector(`[data-id="${id}"]`);
            const row = trigger ? trigger.closest('tr') : null;
            if (row) row.remove();
        }

        // Open modal and stash the id (and name) for confirmation
        function openDeleteModal(triggerEl) {
            const id = triggerEl.getAttribute('data-id');
            const row = triggerEl.closest('tr');
            const first = row.children[1]?.textContent?.trim() ?? '';
            const last = row.children[2]?.textContent?.trim() ?? '';
            document.getElementById('deleteTargetLabel').textContent = `ID ${id}${first || last ? ` (${first} ${last})` : ''}`;

            // Store id on the confirm button
            const confirmBtn = document.getElementById('confirmDeleteBtn');
            confirmBtn.dataset.id = id;

            // Show modal
            const modal = new bootstrap.Modal(document.getElementById('confirmDeleteModal'));
            modal.show();

            // One-time handler for this show (avoid stacking multiple listeners)
            confirmBtn.onclick = function () {
                // Build a temp element that carries the required data-id attribute
                const temp = document.createElement('a');
                temp.setAttribute('data-id', confirmBtn.dataset.id);

                deletePerson(temp); // satisfies the "reads an attribute for an id" requirement
                modal.hide();
            };
        }


        // Load the modal HTML into this page
        fetch('confirmDeleteModal.html')
            .then(response => response.text())
            .then(html => {
                document.getElementById('modal-container').innerHTML = html;
            })
            .then(() => {
                // Optional: reattach event listeners or reinitialize Bootstrap modals if needed
                console.log("Delete confirmation modal loaded.");
            })
            .catch(err => console.error('Failed to load modal:', err));
    </script>


</body>
</html>